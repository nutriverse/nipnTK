<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nipnTK">
<title>Checking ranges and legal values • nipnTK</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Checking ranges and legal values">
<meta property="og:description" content="nipnTK">
<meta property="og:image" content="https://nutriverse.io/nipnTK/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-success"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nipnTK</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/nipnTK.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/rl.html">Check ranges and legal values</a>
    <a class="dropdown-item" href="../articles/sp.html">Identify outliers using scatterplots</a>
    <a class="dropdown-item" href="../articles/flagging.html">Identify outliers using flags</a>
    <a class="dropdown-item" href="../articles/ad.html">Assess distributions of variables and indices</a>
    <a class="dropdown-item" href="../articles/dp.html">Assess digit preference</a>
    <a class="dropdown-item" href="../articles/ah.html">Assess age heaping</a>
    <a class="dropdown-item" href="../articles/sr.html">Assess sex ratio</a>
    <a class="dropdown-item" href="../articles/as.html">Assess age and sex distributions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://fosstodon.org/@katilingban">
    <span class="fab fa fab fa-mastodon fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.linkedin.com/company/katilingban/">
    <span class="fab fa fab fa-linkedin fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nutriverse/nipnTK/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Checking ranges and legal values</h1>
                        <h4 data-toc-skip class="author">Mark Myatt</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nutriverse/nipnTK/blob/HEAD/vignettes/rl.Rmd" class="external-link"><code>vignettes/rl.Rmd</code></a></small>
      <div class="d-none name"><code>rl.Rmd</code></div>
    </div>

    
    
<p>Checking that data are within an acceptable or plausible range is an
important basic check to apply to quantitative data. Checking that data
are recorded with appropriate legal values or codes is an important
basic check to apply to categorical data.</p>
<div class="section level2">
<h2 id="checking-quantitative-data">Checking quantitative data<a class="anchor" aria-label="anchor" href="#checking-quantitative-data"></a>
</h2>
<p>We will use the dataset <code>rl.ex01</code> that is included in the
<strong>nipnTK</strong> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span> <span class="op">&lt;-</span> <span class="va">rl.ex01</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">svy</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;   age sex weight height muac oedema</span></span>
<span><span class="co">#&gt; 1  12   2    6.7   68.5  148      2</span></span>
<span><span class="co">#&gt; 2   6   1    6.4   65.0  125      2</span></span>
<span><span class="co">#&gt; 3   6   2    6.5   65.6  125      2</span></span>
<span><span class="co">#&gt; 4   8   1    7.2   68.4  144      2</span></span>
<span><span class="co">#&gt; 5  12   M    6.1   65.4  114      2</span></span>
<span><span class="co">#&gt; 6   8   1    7.7   66.5  146      2</span></span></code></pre>
<p>The <code>rl.ex01</code> dataset contains anthropometry data from a
SMART survey from Angola.</p>
<p>We can use the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function to examine range (and
other summary statistics) of a quantitative variable:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span><span class="op">)</span></span></code></pre></div>
<p>This returns:</p>
<pre><code><span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;    11.1   128.0   139.0   140.3   148.0   999.0</span></span></code></pre>
<p>A graphical examination can also be made:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span>, horizontal <span class="op">=</span> <span class="cn">TRUE</span>, xlab <span class="op">=</span> <span class="st">"MUAC (mm)"</span>, frame.plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="rl_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>The “whiskers” on the boxplot extend to 1.5 times the interquartile
range from the ends of the box (i.e., the lower and upper quartiles).
This is known as the <em>inner fence</em>. Data points that are outside
the inner fence are considered to be <em>mild outliers</em>. The NiPN
data quality toolkit provides an R language function
<code><a href="../reference/outliersUV.html">outliersUV()</a></code> that uses the same method to identify
outliers:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">[</span><span class="fu"><a href="../reference/outliersUV.html">outliersUV</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
<p>This returns:</p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Univariate outliers : Lower fence = 98, Upper fence = 178</span></span>
<span><span class="co">#&gt;     age sex weight height  muac oedema</span></span>
<span><span class="co">#&gt; 33   24   1    9.8   74.5 180.0      2</span></span>
<span><span class="co">#&gt; 93   12   2    6.7   67.0  96.0      1</span></span>
<span><span class="co">#&gt; 126  16   2    9.0   74.6 999.0      2</span></span>
<span><span class="co">#&gt; 135  18   2    8.5   74.5 999.0      2</span></span>
<span><span class="co">#&gt; 194  24   M    7.0   75.0  95.0      2</span></span>
<span><span class="co">#&gt; 227   8   M    6.2   66.0  11.1      2</span></span>
<span><span class="co">#&gt; 253  35   2    7.6   75.6  97.0      2</span></span>
<span><span class="co">#&gt; 381  24   1   10.8   82.8  12.4      2</span></span>
<span><span class="co">#&gt; 501  36   2   15.5   93.4 185.0      2</span></span>
<span><span class="co">#&gt; 594  21   2    9.8   76.5  13.2      2</span></span>
<span><span class="co">#&gt; 714  59   2   18.9   98.5 180.0      2</span></span>
<span><span class="co">#&gt; 752  48   2   15.6  102.2 999.0      2</span></span>
<span><span class="co">#&gt; 756  59   1   19.4  101.1 180.0      2</span></span>
<span><span class="co">#&gt; 873  59   1   20.6  109.4 179.0      2</span></span></code></pre>
<p>We can count the number of outliers or use:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="../reference/outliersUV.html">outliersUV</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This returns:</p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Univariate outliers : Lower fence = 98, Upper fence = 178</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; FALSE  TRUE </span></span>
<span><span class="co">#&gt;   892    14</span></span></code></pre>
<p>We can express this as a proportion:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="../reference/outliersUV.html">outliersUV</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This returns:</p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Univariate outliers : Lower fence = 98, Upper fence = 178</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      FALSE       TRUE </span></span>
<span><span class="co">#&gt; 0.98454746 0.01545254</span></span></code></pre>
<p>You may find it easier to use percentages:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="../reference/outliersUV.html">outliersUV</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span></code></pre></div>
<p>This returns:</p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Univariate outliers : Lower fence = 98, Upper fence = 178</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     FALSE      TRUE </span></span>
<span><span class="co">#&gt; 98.454746  1.545254</span></span></code></pre>
<p>Some of the <strong>muac</strong> values identified as potential
outliers are possible <strong>muac</strong> values:</p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Univariate outliers : Lower fence = 98, Upper fence = 178</span></span>
<span><span class="co">#&gt;     age sex weight height  muac oedema</span></span>
<span><span class="co">#&gt; 33   24   1    9.8   74.5 180.0      2</span></span>
<span><span class="co">#&gt; 93   12   2    6.7   67.0  96.0      1</span></span>
<span><span class="co">#&gt; 126  16   2    9.0   74.6 999.0      2</span></span>
<span><span class="co">#&gt; 135  18   2    8.5   74.5 999.0      2</span></span>
<span><span class="co">#&gt; 194  24   M    7.0   75.0  95.0      2</span></span>
<span><span class="co">#&gt; 227   8   M    6.2   66.0  11.1      2</span></span>
<span><span class="co">#&gt; 253  35   2    7.6   75.6  97.0      2</span></span>
<span><span class="co">#&gt; 381  24   1   10.8   82.8  12.4      2</span></span>
<span><span class="co">#&gt; 501  36   2   15.5   93.4 185.0      2</span></span>
<span><span class="co">#&gt; 594  21   2    9.8   76.5  13.2      2</span></span>
<span><span class="co">#&gt; 714  59   2   18.9   98.5 180.0      2</span></span>
<span><span class="co">#&gt; 752  48   2   15.6  102.2 999.0      2</span></span>
<span><span class="co">#&gt; 756  59   1   19.4  101.1 180.0      2</span></span>
<span><span class="co">#&gt; 873  59   1   20.6  109.4 179.0      2</span></span></code></pre>
<p>The <code><a href="../reference/outliersUV.html">outliersUV()</a></code> function provides a
<strong>fence</strong> parameter which alters the threshold at which a
data point is considered to be an outlier.</p>
<p>The default <strong>fence = 1.5</strong> defines the <em>inner
fence</em> (i.e <strong>1.5</strong> times the interquartile range below
the lower quartile and above the upper quartile). This will identify
<em>mild</em> and <em>severe</em> outliers.</p>
<p>The value <strong>fence = 3</strong> defines the <em>outer fence</em>
(i.e <strong>3</strong> times the interquartile range below the lower
quartile and above the upper quartile). This will identify
<em>severe</em> outliers only:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">[</span><span class="fu"><a href="../reference/outliersUV.html">outliersUV</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span>, fence <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
<p>This returns:</p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Univariate outliers : Lower fence = 68, Upper fence = 208</span></span>
<span><span class="co">#&gt;     age sex weight height  muac oedema</span></span>
<span><span class="co">#&gt; 126  16   2    9.0   74.6 999.0      2</span></span>
<span><span class="co">#&gt; 135  18   2    8.5   74.5 999.0      2</span></span>
<span><span class="co">#&gt; 227   8   M    6.2   66.0  11.1      2</span></span>
<span><span class="co">#&gt; 381  24   1   10.8   82.8  12.4      2</span></span>
<span><span class="co">#&gt; 594  21   2    9.8   76.5  13.2      2</span></span>
<span><span class="co">#&gt; 752  48   2   15.6  102.2 999.0      2</span></span></code></pre>
<p>There is something wrong with all of these values of
<strong>muac</strong>.</p>
<p>The intention was that the <strong>muac</strong> variable records
mid-upper-arm-circumference (MUAC) in mm. There are some impossibly
small (i.e. <strong>11.1</strong>, <strong>12.4</strong>, and
<strong>13.2</strong>) and impossibly large values
(i.e. <strong>999.0</strong>).</p>
<p>The three impossibly small values are probably due to data being
recorded in cm rather than mm. It is probably safe to change these three
values to 111, 124 and 132. It is easiest to do this each record
separately:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span><span class="op">[</span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span> <span class="op">==</span> <span class="fl">11.1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">111</span></span></code></pre></div>
<p>An alternative approach is to specify row numbers instead of
values:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span><span class="op">[</span><span class="fl">381</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">124</span></span>
<span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span><span class="op">[</span><span class="fl">594</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">132</span></span></code></pre></div>
<p>The three <strong>999.0</strong> values are missing values coded as
999.0. It is safe to set these three values to missing using the special
NA value:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span><span class="op">[</span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span> <span class="op">==</span> <span class="fl">999.00</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>Range checks should be repeated after editing the data to ensure that
the problems have been fixed:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span><span class="op">)</span></span>
<span><span class="va">svy</span><span class="op">[</span><span class="fu"><a href="../reference/outliersUV.html">outliersUV</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">svy</span><span class="op">[</span><span class="fu"><a href="../reference/outliersUV.html">outliersUV</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span>, fence <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
<p>Following is a boxplot of the <strong>muac</strong> variable made
using:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span>, horizontal <span class="op">=</span> <span class="cn">TRUE</span>, xlab <span class="op">=</span> <span class="st">"MUAC (mm)"</span>, frame.plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>after the fixes for incorrectly entered data and missing values were
made.</p>
<p><img src="rl_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<p>There should now be no severe outliers:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="../reference/outliersUV.html">outliersUV</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">muac</span>, fence <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span></code></pre></div>
<p>returns:</p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Univariate outliers : Lower fence = 68, Upper fence = 208</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; FALSE </span></span>
<span><span class="co">#&gt;   100</span></span></code></pre>
<p>It is usually better to identify and edit only the most extreme
<em>univariate</em> outliers, as we have done here, and use the
scatterplot and statistical distance methods described elsewhere in this
toolkit to identify other potential outliers.</p>
</div>
<div class="section level2">
<h2 id="editing-data">Editing data<a class="anchor" aria-label="anchor" href="#editing-data"></a>
</h2>
<p>We have edited records with outliers at the <em>R</em> command
line.</p>
<p>It is a good idea to edit data at the command line or using a script
containing the required commands.</p>
<p>A script provides a record of changes made to the data.</p>
<p><em>R</em> also keeps a record of whatever you do at the command line
in a “history file”. The history file is a plain text file which is
usually called .Rhistory and stored in your home directory.</p>
<p>Some regulatory authorities require you to keep a history file.</p>
<p>Some publications may require you to provide a “reproducible data
analysis”. This could be an edited and annotated copy of your history
file.</p>
<p>The <code><a href="https://rdrr.io/r/utils/edit.html" class="external-link">edit()</a></code> function provides a basic tool for editing
data interactively.</p>
<p>Editing data using the <code><a href="https://rdrr.io/r/utils/edit.html" class="external-link">edit()</a></code> function is typically a
three stage process:</p>
<ol style="list-style-type: decimal">
<li><p>Create a new object containing only the data that requires
editing.</p></li>
<li><p>Use the <code><a href="https://rdrr.io/r/utils/edit.html" class="external-link">edit()</a></code> function to edit data in the new
object closing the data editor window when you are finished.</p></li>
<li><p>Replace the old records with the edited records.</p></li>
</ol>
<p>We will try this using a separate copy of the example data:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">rl.ex01</span></span>
<span><span class="va">records2update</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="../reference/outliersUV.html">outliersUV</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">muac</span>, fence <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">records2update</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/edit.html" class="external-link">edit</a></span><span class="op">(</span><span class="va">records2update</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">records2update</span><span class="op">)</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">records2update</span></span></code></pre></div>
<p>We can check that the edits have been made using:</p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Univariate outliers : Lower fence = 68, Upper fence = 208</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="../reference/outliersUV.html">outliersUV</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">muac</span>, fence <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
<p>If you have fixed the problems in the data this should return:</p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Univariate outliers : Lower fence = 68, Upper fence = 208</span></span>
<span><span class="co">#&gt;     age sex weight height  muac oedema</span></span>
<span><span class="co">#&gt; 126  16   2    9.0   74.6 999.0      2</span></span>
<span><span class="co">#&gt; 135  18   2    8.5   74.5 999.0      2</span></span>
<span><span class="co">#&gt; 227   8   M    6.2   66.0  11.1      2</span></span>
<span><span class="co">#&gt; 381  24   1   10.8   82.8  12.4      2</span></span>
<span><span class="co">#&gt; 594  21   2    9.8   76.5  13.2      2</span></span>
<span><span class="co">#&gt; 752  48   2   15.6  102.2 999.0      2</span></span></code></pre>
<p>The <code><a href="https://rdrr.io/r/utils/edit.html" class="external-link">edit()</a></code> function works differently on different
operating systems and with different graphical user interfaces. If you
are using <em>RStudio</em> or <em>RAnalyticFlow</em> on OS X you will
need to install <em>XQuartz</em> if you want to use the
<code><a href="https://rdrr.io/r/utils/edit.html" class="external-link">edit()</a></code> function. <em>XQuartz</em> is available from:</p>
<p><a href="https://www.xquartz.org/index.html" class="external-link">https://www.xquartz.org/index.html</a></p>
</div>
<div class="section level2">
<h2 id="checking-categorical-variables">Checking categorical variables<a class="anchor" aria-label="anchor" href="#checking-categorical-variables"></a>
</h2>
<p>We can use the <strong>table()</strong> function to examine the codes
used in categorical variables. For example:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span></code></pre></div>
<p>returns:</p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   1   2   3   F   M </span></span>
<span><span class="co">#&gt; 404 458   1  24  19</span></span></code></pre>
<p>The intention was that the <strong>sex</strong> variable was coded
using 1 for male and 2 for female but in a small number of records the
codes <strong>M</strong> for male and <strong>F</strong> for female have
been used. A mixed coding scheme like this will complicate
data-management and data-analysis. Data in the sex variable should be
edited to ensure that consistent coding is used:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">$</span><span class="va">sex</span><span class="op">[</span><span class="va">svy</span><span class="op">$</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">svy</span><span class="op">$</span><span class="va">sex</span><span class="op">[</span><span class="va">svy</span><span class="op">$</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"F"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></code></pre></div>
<p>You may find that a few records contain meaningless codes. The code
<strong>3</strong> in the example dataset has, very probably, no meaning
and is likely to be a simple data entry error. This record should be
checked and corrected, if possible. If the record cannot be corrected
then the <strong>sex</strong> variable should be set to missing:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">$</span><span class="va">sex</span><span class="op">[</span><span class="va">svy</span><span class="op">$</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>Legal value checks should be repeated after editing to ensure that
problems have been fixed:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span></code></pre></div>
<p>now returns:</p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   1   2   3   F   M </span></span>
<span><span class="co">#&gt; 423 482   0   0   0</span></span></code></pre>
<p>The table contains cells for the values <strong>M</strong>,
<strong>F</strong>, and <strong>3</strong> because <em>R</em> imported
the variable as a categorical or “factor” variable:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">svy</span><span class="op">)</span></span></code></pre></div>
<p>returns:</p>
<pre><code><span><span class="co">#&gt; 'data.frame':    906 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;  $ age   : int  12 6 6 8 12 8 18 9 12 12 ...</span></span>
<span><span class="co">#&gt;  $ sex   : Factor w/ 5 levels "1","2","3","F",..: 2 1 2 1 1 1 1 1 2 1 ...</span></span>
<span><span class="co">#&gt;  $ weight: num  6.7 6.4 6.5 7.2 6.1 7.7 6.4 7.8 7.5 6.5 ...</span></span>
<span><span class="co">#&gt;  $ height: num  68.5 65 65.6 68.4 65.4 66.5 66.7 65.3 69.1 70.3 ...</span></span>
<span><span class="co">#&gt;  $ muac  : num  148 125 125 144 114 146 119 140 138 121 ...</span></span>
<span><span class="co">#&gt;  $ oedema: int  2 2 2 2 2 2 2 2 2 2 ...</span></span></code></pre>
<p>We can fix this by redefining the levels of the sex variable:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   1   2 </span></span>
<span><span class="co">#&gt; 423 482</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="saving-changes">Saving changes<a class="anchor" aria-label="anchor" href="#saving-changes"></a>
</h2>
<p>We have edited some data.</p>
<p>We usually want to save changes.</p>
<p>It is simple to save a dataset in a comma-separated-value (CSV) text
file using the <code><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table()</a></code> function:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">svy</span>, file <span class="op">=</span> <span class="st">"rl.ex01.clean.csv"</span>, sep <span class="op">=</span> <span class="st">","</span>, quote <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>            row.names <span class="op">=</span> <span class="cn">FALSE</span>, fileEncoding <span class="op">=</span> <span class="st">"ASCII"</span><span class="op">)</span></span></code></pre></div>
<p><em>R</em> can work with a variety of files format but it is usually
simplest to work with simple text files.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mark Myatt, Ernest Guevarra.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
