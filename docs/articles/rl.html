<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checking ranges and legal values • nipnTK</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Checking ranges and legal values">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nipnTK</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tk.html">The NiPN data quality toolkit</a>
    </li>
    <li>
      <a href="../articles/rl.html">Check ranges and legal values</a>
    </li>
    <li>
      <a href="../articles/sp.html">Identify outliers using scatterplots</a>
    </li>
    <li>
      <a href="../articles/flagging.html">Identify outliers using flags</a>
    </li>
    <li>
      <a href="../articles/ad.html">Assess distributions of variables and indices</a>
    </li>
    <li>
      <a href="../articles/dp.html">Assess digit preference</a>
    </li>
    <li>
      <a href="../articles/ah.html">Assess age heaping</a>
    </li>
    <li>
      <a href="../articles/sr.html">Assess sex ratio</a>
    </li>
    <li>
      <a href="../articles/as.html">Assess age and sex distributions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nutriverse/nipnTK">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Checking ranges and legal values</h1>
                        <h4 class="author">Mark Myatt</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nutriverse/nipnTK/blob/master/vignettes/rl.Rmd"><code>vignettes/rl.Rmd</code></a></small>
      <div class="hidden name"><code>rl.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(nipnTK)</a></code></pre></div>
<p>Checking that data are within an acceptable or plausible range is an important basic check to apply to quantitative data. Checking that data are recorded with appropriate legal values or codes is an important basic check to apply to categorical data.</p>
<div id="checking-quantitative-data" class="section level2">
<h2 class="hasAnchor">
<a href="#checking-quantitative-data" class="anchor"></a>Checking quantitative data</h2>
<p>We will use the dataset <code>rl.ex01</code> that is included in the <strong>nipnTK</strong> package.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">svy &lt;-<span class="st"> </span>rl.ex01</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(svy)</a></code></pre></div>
<pre><code>#&gt;   age sex weight height muac oedema
#&gt; 1  12   2    6.7   68.5  148      2
#&gt; 2   6   1    6.4   65.0  125      2
#&gt; 3   6   2    6.5   65.6  125      2
#&gt; 4   8   1    7.2   68.4  144      2
#&gt; 5  12   M    6.1   65.4  114      2
#&gt; 6   8   1    7.7   66.5  146      2</code></pre>
<p>The <code>rl.ex01</code> dataset contains anthropometry data from a SMART survey from Angola.</p>
<p>We can use the <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function to examine range (and other summary statistics) of a quantitative variable:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(svy<span class="op">$</span>muac)</a></code></pre></div>
<p>This returns:</p>
<pre><code>#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#&gt;    11.1   128.0   139.0   140.3   148.0   999.0</code></pre>
<p>A graphical examination can also be made:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span>(svy<span class="op">$</span>muac, <span class="dt">horizontal =</span> <span class="ot">TRUE</span>, <span class="dt">xlab =</span> <span class="st">"MUAC (mm)"</span>, <span class="dt">frame.plot =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="rl_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>The “whiskers” on the boxplot extend to 1.5 times the interquartile range from the ends of the box (i.e., the lower and upper quartiles). This is known as the <em>inner fence</em>. Data points that are outside the inner fence are considered to be <em>mild outliers</em>. The NiPN data quality toolkit provides an R language function <code><a href="../reference/outliersUV.html">outliersUV()</a></code> that uses the same method to identify outliers:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">svy[<span class="kw"><a href="../reference/outliersUV.html">outliersUV</a></span>(svy<span class="op">$</span>muac), ]</a></code></pre></div>
<p>This returns:</p>
<pre><code>#&gt; 
#&gt; Univariate outliers : Lower fence = 98, Upper fence = 178
#&gt;     age sex weight height  muac oedema
#&gt; 33   24   1    9.8   74.5 180.0      2
#&gt; 93   12   2    6.7   67.0  96.0      1
#&gt; 126  16   2    9.0   74.6 999.0      2
#&gt; 135  18   2    8.5   74.5 999.0      2
#&gt; 194  24   M    7.0   75.0  95.0      2
#&gt; 227   8   M    6.2   66.0  11.1      2
#&gt; 253  35   2    7.6   75.6  97.0      2
#&gt; 381  24   1   10.8   82.8  12.4      2
#&gt; 501  36   2   15.5   93.4 185.0      2
#&gt; 594  21   2    9.8   76.5  13.2      2
#&gt; 714  59   2   18.9   98.5 180.0      2
#&gt; 752  48   2   15.6  102.2 999.0      2
#&gt; 756  59   1   19.4  101.1 180.0      2
#&gt; 873  59   1   20.6  109.4 179.0      2</code></pre>
<p>We can count the number of outliers or use:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="kw"><a href="../reference/outliersUV.html">outliersUV</a></span>(svy<span class="op">$</span>muac))</a></code></pre></div>
<p>This returns:</p>
<pre><code>#&gt; 
#&gt; Univariate outliers : Lower fence = 98, Upper fence = 178
#&gt; 
#&gt; FALSE  TRUE 
#&gt;   892    14</code></pre>
<p>We can express this as a proportion:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/prop.table.html">prop.table</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="kw"><a href="../reference/outliersUV.html">outliersUV</a></span>(svy<span class="op">$</span>muac)))</a></code></pre></div>
<p>This returns:</p>
<pre><code>#&gt; 
#&gt; Univariate outliers : Lower fence = 98, Upper fence = 178
#&gt; 
#&gt;      FALSE       TRUE 
#&gt; 0.98454746 0.01545254</code></pre>
<p>You may find it easier to use percentages:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/prop.table.html">prop.table</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="kw"><a href="../reference/outliersUV.html">outliersUV</a></span>(svy<span class="op">$</span>muac))) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a></code></pre></div>
<p>This returns:</p>
<pre><code>#&gt; 
#&gt; Univariate outliers : Lower fence = 98, Upper fence = 178
#&gt; 
#&gt;     FALSE      TRUE 
#&gt; 98.454746  1.545254</code></pre>
<p>Some of the <strong>muac</strong> values identified as potential outliers are possible <strong>muac</strong> values:</p>
<pre><code>#&gt; 
#&gt; Univariate outliers : Lower fence = 98, Upper fence = 178
#&gt;     age sex weight height  muac oedema
#&gt; 33   24   1    9.8   74.5 180.0      2
#&gt; 93   12   2    6.7   67.0  96.0      1
#&gt; 126  16   2    9.0   74.6 999.0      2
#&gt; 135  18   2    8.5   74.5 999.0      2
#&gt; 194  24   M    7.0   75.0  95.0      2
#&gt; 227   8   M    6.2   66.0  11.1      2
#&gt; 253  35   2    7.6   75.6  97.0      2
#&gt; 381  24   1   10.8   82.8  12.4      2
#&gt; 501  36   2   15.5   93.4 185.0      2
#&gt; 594  21   2    9.8   76.5  13.2      2
#&gt; 714  59   2   18.9   98.5 180.0      2
#&gt; 752  48   2   15.6  102.2 999.0      2
#&gt; 756  59   1   19.4  101.1 180.0      2
#&gt; 873  59   1   20.6  109.4 179.0      2</code></pre>
<p>The <code><a href="../reference/outliersUV.html">outliersUV()</a></code> function provides a <strong>fence</strong> parameter which alters the threshold at which a data point is considered to be an outlier.</p>
<p>The default <strong>fence = 1.5</strong> defines the <em>inner fence</em> (i.e <strong>1.5</strong> times the interquartile range below the lower quartile and above the upper quartile). This will identify <em>mild</em> and <em>severe</em> outliers.</p>
<p>The value <strong>fence = 3</strong> defines the <em>outer fence</em> (i.e <strong>3</strong> times the interquartile range below the lower quartile and above the upper quartile). This will identify <em>severe</em> outliers only:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">svy[<span class="kw"><a href="../reference/outliersUV.html">outliersUV</a></span>(svy<span class="op">$</span>muac, <span class="dt">fence =</span> <span class="dv">3</span>), ]</a></code></pre></div>
<p>This returns:</p>
<pre><code>#&gt; 
#&gt; Univariate outliers : Lower fence = 68, Upper fence = 208
#&gt;     age sex weight height  muac oedema
#&gt; 126  16   2    9.0   74.6 999.0      2
#&gt; 135  18   2    8.5   74.5 999.0      2
#&gt; 227   8   M    6.2   66.0  11.1      2
#&gt; 381  24   1   10.8   82.8  12.4      2
#&gt; 594  21   2    9.8   76.5  13.2      2
#&gt; 752  48   2   15.6  102.2 999.0      2</code></pre>
<p>There is something wrong with all of these values of <strong>muac</strong>.</p>
<p>The intention was that the <strong>muac</strong> variable records mid-upper-arm-circumference (MUAC) in mm. There are some impossibly small (i.e. <strong>11.1</strong>, <strong>12.4</strong>, and <strong>13.2</strong>) and impossibly large values (i.e. <strong>999.0</strong>).</p>
<p>The three impossibly small values are probably due to data being recorded in cm rather than mm. It is probably safe to change these three values to 111, 124 and 132. It is easiest to do this each record separately:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">svy<span class="op">$</span>muac[svy<span class="op">$</span>muac <span class="op">==</span><span class="st"> </span><span class="fl">11.1</span>] &lt;-<span class="st"> </span><span class="dv">111</span></a></code></pre></div>
<p>An alternative approach is to specify row numbers instead of values:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">svy<span class="op">$</span>muac[<span class="dv">381</span>] &lt;-<span class="st"> </span><span class="dv">124</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2">svy<span class="op">$</span>muac[<span class="dv">594</span>] &lt;-<span class="st"> </span><span class="dv">132</span></a></code></pre></div>
<p>The three <strong>999.0</strong> values are missing values coded as 999.0. It is safe to set these three values to missing using the special NA value:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">svy<span class="op">$</span>muac[svy<span class="op">$</span>muac <span class="op">==</span><span class="st"> </span><span class="fl">999.00</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></a></code></pre></div>
<p>Range checks should be repeated after editing the data to ensure that the problems have been fixed:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(svy<span class="op">$</span>muac)</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">svy[<span class="kw"><a href="../reference/outliersUV.html">outliersUV</a></span>(svy<span class="op">$</span>muac), ]</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">svy[<span class="kw"><a href="../reference/outliersUV.html">outliersUV</a></span>(svy<span class="op">$</span>muac, <span class="dt">fence =</span> <span class="dv">3</span>), ]</a></code></pre></div>
<p>Following is a boxplot of the <strong>muac</strong> variable made using:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span>(svy<span class="op">$</span>muac, <span class="dt">horizontal =</span> <span class="ot">TRUE</span>, <span class="dt">xlab =</span> <span class="st">"MUAC (mm)"</span>, <span class="dt">frame.plot =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>after the fixes for incorrectly entered data and missing values were made.</p>
<p><img src="rl_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<p>There should now be no severe outliers:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/prop.table.html">prop.table</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="kw"><a href="../reference/outliersUV.html">outliersUV</a></span>(svy<span class="op">$</span>muac, <span class="dt">fence =</span> <span class="dv">3</span>))) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a></code></pre></div>
<p>returns:</p>
<pre><code>#&gt; 
#&gt; Univariate outliers : Lower fence = 68, Upper fence = 208
#&gt; 
#&gt; FALSE 
#&gt;   100</code></pre>
<p>It is usually better to identify and edit only the most extreme <em>univariate</em> outliers, as we have done here, and use the scatterplot and statistical distance methods described elsewhere in this toolkit to identify other potential outliers.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#checking-quantitative-data">Checking quantitative data</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mark Myatt, Ernest Guevarra.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
