<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nipnTK">
<title>Identifying outliers using flags • nipnTK</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Identifying outliers using flags">
<meta property="og:description" content="nipnTK">
<meta property="og:image" content="https://nutriverse.io/nipnTK/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-success"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nipnTK</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.2.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/nipnTK.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/rl.html">Check ranges and legal values</a>
    <a class="dropdown-item" href="../articles/sp.html">Identify outliers using scatterplots</a>
    <a class="dropdown-item" href="../articles/flagging.html">Identify outliers using flags</a>
    <a class="dropdown-item" href="../articles/ad.html">Assess distributions of variables and indices</a>
    <a class="dropdown-item" href="../articles/dp.html">Assess digit preference</a>
    <a class="dropdown-item" href="../articles/ah.html">Assess age heaping</a>
    <a class="dropdown-item" href="../articles/sr.html">Assess sex ratio</a>
    <a class="dropdown-item" href="../articles/as.html">Assess age and sex distributions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://fosstodon.org/@katilingban">
    <span class="fab fa fab fa-mastodon fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.linkedin.com/company/katilingban/">
    <span class="fab fa fab fa-linkedin fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nutriverse/nipnTK/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="flagging_files/kePrint-0.0.1/kePrint.js"></script><link href="flagging_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Identifying outliers using flags</h1>
                        <h4 data-toc-skip class="author">Mark Myatt</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nutriverse/nipnTK/blob/HEAD/vignettes/flagging.Rmd" class="external-link"><code>vignettes/flagging.Rmd</code></a></small>
      <div class="d-none name"><code>flagging.Rmd</code></div>
    </div>

    
    
<p>Flagging is a way of identifying records for which there is a strong
likelihood that values of anthropometric measurements or the age of the
child are incorrect. Records can then be checked and corrected, or
censored (i.e. excluded) from subsequent analyses.</p>
<p>Flagging is a process of checking whether values of anthropometric
indices are outside a given range and recording the result in one or
more new variables. The result may be a set of logical (i.e. 1/0 or
true/false) flag variables (i.e. one flag variable per anthropometric
index) or a single variable holding a code number that classifies the
nature of the detected problem(s).</p>
<p>Flagging is usually applied to height-for-age z-scores (HAZ),
weight-for-age z-scores (WAZ), weight-for-height z-scores (WHZ), and
BMI-for-age z-scores (BAZ) calculated from data collected during
nutritional anthropometry surveys. The flagging process can be easily
applied to other variables.</p>
<p>Two flagging criteria for anthropometric indices are in common use
internationally. These are the WHO flagging criteria and the SMART
flagging criteria. Both methods flag records in which one or more
anthropometric indices are more than a certain distance either side of a
reference value. The two methods are summarised in table below.</p>
<p> </p>
<table class="table table" style="width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;">
<caption>
WHO and SMART flagging criteria
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="8">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Anthropometric index<span class="math inline">\(^ 1\)</span>
</div>
</th>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
</tr>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
HAZ
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
WAZ
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
WHZ
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
BAZ
</div>
</th>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Lower limit
</th>
<th style="text-align:left;">
Upper limit
</th>
<th style="text-align:left;">
Lower limit
</th>
<th style="text-align:left;">
Upper limit
</th>
<th style="text-align:left;">
Lower limit
</th>
<th style="text-align:left;">
Upper limit
</th>
<th style="text-align:left;">
Lower limit
</th>
<th style="text-align:left;">
Upper limit
</th>
<th style="text-align:left;">
Reference value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
WHO
</td>
<td style="text-align:left;">
-6
</td>
<td style="text-align:left;">
+6
</td>
<td style="text-align:left;">
-6
</td>
<td style="text-align:left;">
+5
</td>
<td style="text-align:left;">
-5
</td>
<td style="text-align:left;">
+5
</td>
<td style="text-align:left;">
-5
</td>
<td style="text-align:left;">
+5
</td>
<td style="text-align:left;">
Zero
</td>
</tr>
<tr>
<td style="text-align:left;">
SMART
</td>
<td style="text-align:left;">
-3
</td>
<td style="text-align:left;">
+3
</td>
<td style="text-align:left;">
-3
</td>
<td style="text-align:left;">
+3
</td>
<td style="text-align:left;">
-3
</td>
<td style="text-align:left;">
+3
</td>
<td style="text-align:left;">
NA<span class="math inline">\(^ 2\)</span>
</td>
<td style="text-align:left;">
NA<span class="math inline">\(^ 2\)</span>
</td>
<td style="text-align:left;">
Survey sample
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup>1</sup> Indices are height-for-age z-score (HAZ), weight-for-age
z-score (WAZ), weight-for-height z-score (WHZ), and BMI-for-age z-score
(BAZ).
</td>
</tr>
<tr>
<td style="padding: 0; " colspan="100%">
<sup>2</sup> NA = Not available. BAZ is not used in SMART surveys. SMART
flagging criteria for BAZ are undefined.
</td>
</tr>
</tfoot>
</table>
<p> </p>
<p>Applying flagging criteria is a matter of checking that individual
values of these indices are within the lower and upper limits shown in
the table above. Values that are outside of these limits are flagged in
a new variable.</p>
<p>The WHO criteria are simple <em>biologically plausible</em> ranges.
If, for example, a value for WHZ is below -5 or above +5 then the record
is flagged to indicate a likely problem with WHZ. This will usually be
caused by an erroneous weight or height value being recorded.</p>
<p>Note that values outside of these flagging limits may be observed in
children admitted into (e.g.) therapeutic feeding programs.</p>
<p>SMART criteria are more complicated. They require the mean value of
the index to be calculated from the survey data. This is then used as
the reference value. For example, if a value for WHZ is below:</p>
<p> </p>
<p><span class="math display">\[ \text{mean WHZ} ~ - ~ 3 \]</span></p>
<p> </p>
<p>or above:</p>
<p> </p>
<p><span class="math display">\[ \text{mean WHZ} ~ + ~ 3 \]</span></p>
<p> </p>
<p>then the record is flagged to indicate a likely problem with WHZ.</p>
<p>A mean WHZ of -1.15 gives lower and upper SMART flagging limits
of:</p>
<p> </p>
<p><span class="math display">\[ -1.15 ~ - ~ 3 ~ = ~ -4.15 \]</span></p>
<p> </p>
<p>and:</p>
<p> </p>
<p><span class="math display">\[ -1.15 ~ + ~ 3 ~ = ~ +1.85 \]</span></p>
<p> </p>
<p>respectively. These limits may incorrectly flag biologically
plausible values. See figure below.</p>
<p> </p>
<div class="figure" style="text-align: center">
<img src="../reference/figures/flagging1.png" alt="Example of WHO and SMART flagging criteria for weight-for-height z-scores (WHZ)" width="70%"><p class="caption">
Example of WHO and SMART flagging criteria for weight-for-height
z-scores (WHZ)
</p>
</div>
<p> </p>
<p>The WHO and SMART flagging criteria will flag different but
overlapping sets of measurements. This means that survey results can be
affected by the flagging criteria used. This is because the prevalence
of an indicator describes the proportion of values in one of the “tails”
of the distribution of an index (see figure below).</p>
<p>The SMART flagging criteria will usually flag more records than the
WHO flagging criteria. This will act to reduce estimated prevalence (see
figure below). This will be a particular problem when the prevalence of
severe forms of undernutrition is high.</p>
<p>There are some problems with using the SMART flagging criteria:</p>
<ol style="list-style-type: decimal">
<li><p>Flagging is about detecting outlier values. The SMART flagging
criteria use distance from the sample mean, but the value of the mean
can be strongly influenced by the presence of outliers. This could be
overcome by, for example, using the median or a trimmed mean as the
reference mean. If you do this you will not be using the SMART flagging
criteria.</p></li>
<li><p>SMART flagging criteria are supposed to define outliers using
statistically plausible limits. The underlying principle is that, for a
normally distributed variable, we expect 99.87% of all values to lie
within three sample standard deviations of the sample mean. If we
exclude records with values more than three standard deviations from the
mean then we would incorrectly flag very few records (i.e. 0.13% of the
total) as problematic. The SMART method assumes that the distribution of
each anthropometric index in a population is always perfectly normal and
that the standard deviation is always exactly one. This assumption is
almost always violated. If it is violated then the use of the SMART
flagging criteria may lead to records being flagged inappropriately.
There are ways (e.g. transforming data toward normality, using the
sample standard deviation) to avoid this problem but using them would
also not be using the SMART flagging criteria.</p></li>
<li><p>Wide-area surveys such as MICS and DHS will usually collect data
from many populations. Each population may have different distributions
of anthropometric indices and different prevalence of anthropometric
indicators. In this case the mean of the entire survey sample will not
be a suitable reference mean and the assumed standard deviation (i.e. SD
= 1) will usually be too narrow to set limits that define statistical
outliers. This will lead to records being flagged incorrectly. This is
illustrated in Figure F3. Stratum or district specific means should be
used instead of whole sample means, but this may not solve the problem
entirely.</p></li>
</ol>
<p>If SMART flagging criteria have already been applied to data and the
flagged records have been removed from the dataset then a subsequent
application of the SMART flagging criteria will tend to flag additional
records. SMART flagging criteria should, therefore, only be applied to
raw data. Do not apply SMART flagging criteria to data from which
flagged records have been removed.</p>
<p>It is important to note that only one set of flagging criteria,
either WHO or SMART, should be used at any one time.</p>
<p>The WHO and SMART flagging criteria are designed to be applied to
survey samples. They should not be applied to clinical populations or
samples.</p>
<p>Software such as ENA from SMART, EpiInfo, WHO Anthro, WHO AnthroPlus,
and scripts / macros for R, SAS, SPSS, and STATA provided by the WHO are
frequently used to calculate anthropometric indices and apply flagging
criteria to data from surveys that collect anthropometric data. It is
quite common to receive data to which flagging criteria have already
been applied and contain one or more flag variables. You may use these
flags if you are sure which flagging criteria have been applied. If you
are unsure which flagging criteria have been applied then you should
apply your flagging criteria of choice using one of these software
packages or the procedures outlined in this section. You may also need
to recalculate anthropometric indices using WHO reference values if they
were calculated using NCHS, CDC, or local growth references.</p>
<div class="section level2">
<h2 id="applying-who-flagging-criteria-to-survey-data">Applying WHO flagging criteria to survey data<a class="anchor" aria-label="anchor" href="#applying-who-flagging-criteria-to-survey-data"></a>
</h2>
<p>For a first exercise, we will apply the WHO flagging criteria to
survey data.</p>
<p>We will retrieve a survey dataset:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="st">"flag.ex01.csv"</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;   psu child age sex weight height muac oedema   haz   waz   whz</span></span>
<span><span class="co">#&gt; 1   1     1  20   2    6.1   82.5  127      2 -0.07 -4.54 -6.03</span></span>
<span><span class="co">#&gt; 2   1     2  13   2    6.4   70.4  116      2 -1.83 -3.04 -2.93</span></span>
<span><span class="co">#&gt; 3   1     3  15   1    7.1   67.5  124      2 -4.60 -3.34 -1.25</span></span>
<span><span class="co">#&gt; 4   1     4  15   1    7.2   75.4  130      2 -1.48 -3.22 -3.57</span></span>
<span><span class="co">#&gt; 5   1     5  15   1    7.4   70.0  124      2 -3.61 -2.99 -1.61</span></span>
<span><span class="co">#&gt; 6   1     6  18   2    7.7   70.6  130      2 -3.48 -2.40 -0.82</span></span></code></pre>
<p>The file <strong>flag.ex01.csv</strong> is a comma-separated-value
(CSV) file containing anthropometric data from a recent SMART survey in
Sudan.</p>
<p>Applying WHO flagging criteria is straightforward. We first create a
column that will contain the flag code and set this to zero (i.e. no
flags) for all records:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;   psu child age sex weight height muac oedema   haz   waz   whz flag</span></span>
<span><span class="co">#&gt; 1   1     1  20   2    6.1   82.5  127      2 -0.07 -4.54 -6.03    0</span></span>
<span><span class="co">#&gt; 2   1     2  13   2    6.4   70.4  116      2 -1.83 -3.04 -2.93    0</span></span>
<span><span class="co">#&gt; 3   1     3  15   1    7.1   67.5  124      2 -4.60 -3.34 -1.25    0</span></span>
<span><span class="co">#&gt; 4   1     4  15   1    7.2   75.4  130      2 -1.48 -3.22 -3.57    0</span></span>
<span><span class="co">#&gt; 5   1     5  15   1    7.4   70.0  124      2 -3.61 -2.99 -1.61    0</span></span>
<span><span class="co">#&gt; 6   1     6  18   2    7.7   70.6  130      2 -3.48 -2.40 -0.82    0</span></span></code></pre>
<p>Then we apply the flagging criteria for each index. Here we apply the
WHO flagging criteria to the HAZ index:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">haz</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">haz</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">6</span> <span class="op">|</span> <span class="va">svy</span><span class="op">$</span><span class="va">haz</span> <span class="op">&gt;</span> <span class="fl">6</span><span class="op">)</span>, <span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">svy</span><span class="op">$</span><span class="va">flag</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;   psu child age sex weight height muac oedema   haz   waz   whz flag</span></span>
<span><span class="co">#&gt; 1   1     1  20   2    6.1   82.5  127      2 -0.07 -4.54 -6.03    0</span></span>
<span><span class="co">#&gt; 2   1     2  13   2    6.4   70.4  116      2 -1.83 -3.04 -2.93    0</span></span>
<span><span class="co">#&gt; 3   1     3  15   1    7.1   67.5  124      2 -4.60 -3.34 -1.25    0</span></span>
<span><span class="co">#&gt; 4   1     4  15   1    7.2   75.4  130      2 -1.48 -3.22 -3.57    0</span></span>
<span><span class="co">#&gt; 5   1     5  15   1    7.4   70.0  124      2 -3.61 -2.99 -1.61    0</span></span>
<span><span class="co">#&gt; 6   1     6  18   2    7.7   70.6  130      2 -3.48 -2.40 -0.82    0</span></span></code></pre>
<p>This can be translated as <em>“if HAZ is not missing and HAZ is below
-6 or HAZ is above +6 then add 1 to the flag variable else leave the
flag variable unchanged”</em>.</p>
<p>Be careful when using the <span class="math inline">\(&lt;\)</span>
comparison operator with negative numbers. Always insert a space between
the <span class="math inline">\(&lt;\)</span> and <span class="math inline">\(–\)</span> characters. <em>R</em> interprets <span class="math inline">\(&lt;-\)</span> as an assignment operator and may
produce unexpected and unwanted results without issuing a warning or
error message.</p>
<p>Here we apply the WHO flagging criteria to the WHZ index:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">whz</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">whz</span> <span class="op">&lt;</span> <span class="op">-</span> <span class="fl">5</span> <span class="op">|</span> <span class="va">svy</span><span class="op">$</span><span class="va">whz</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span>, <span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">+</span> <span class="fl">2</span>, <span class="va">svy</span><span class="op">$</span><span class="va">flag</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;   psu child age sex weight height muac oedema   haz   waz   whz flag</span></span>
<span><span class="co">#&gt; 1   1     1  20   2    6.1   82.5  127      2 -0.07 -4.54 -6.03    2</span></span>
<span><span class="co">#&gt; 2   1     2  13   2    6.4   70.4  116      2 -1.83 -3.04 -2.93    0</span></span>
<span><span class="co">#&gt; 3   1     3  15   1    7.1   67.5  124      2 -4.60 -3.34 -1.25    0</span></span>
<span><span class="co">#&gt; 4   1     4  15   1    7.2   75.4  130      2 -1.48 -3.22 -3.57    0</span></span>
<span><span class="co">#&gt; 5   1     5  15   1    7.4   70.0  124      2 -3.61 -2.99 -1.61    0</span></span>
<span><span class="co">#&gt; 6   1     6  18   2    7.7   70.6  130      2 -3.48 -2.40 -0.82    0</span></span></code></pre>
<p>Here we apply the WHO flagging criteria to the WAZ index:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">waz</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">waz</span> <span class="op">&lt;</span> <span class="op">-</span> <span class="fl">6</span> <span class="op">|</span> <span class="va">svy</span><span class="op">$</span><span class="va">waz</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span>, <span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">+</span> <span class="fl">4</span>, <span class="va">svy</span><span class="op">$</span><span class="va">flag</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;   psu child age sex weight height muac oedema   haz   waz   whz flag</span></span>
<span><span class="co">#&gt; 1   1     1  20   2    6.1   82.5  127      2 -0.07 -4.54 -6.03    2</span></span>
<span><span class="co">#&gt; 2   1     2  13   2    6.4   70.4  116      2 -1.83 -3.04 -2.93    0</span></span>
<span><span class="co">#&gt; 3   1     3  15   1    7.1   67.5  124      2 -4.60 -3.34 -1.25    0</span></span>
<span><span class="co">#&gt; 4   1     4  15   1    7.2   75.4  130      2 -1.48 -3.22 -3.57    0</span></span>
<span><span class="co">#&gt; 5   1     5  15   1    7.4   70.0  124      2 -3.61 -2.99 -1.61    0</span></span>
<span><span class="co">#&gt; 6   1     6  18   2    7.7   70.6  130      2 -3.48 -2.40 -0.82    0</span></span></code></pre>
<p>Note that each time we apply a flagging criteria we increase the
value of the flagging variable by the next power of two when a problem
is detected:</p>
<pre><code>We started with zero

Then we added $2 ^ 0$ (i.e. 1) if HAZ was out of range. 

Then we added $2 ^ 1$ (i.e. 2) if WHZ was out of range. 

Then we added $2 ^ 2$ (i.e. 4) if WAZ was out of range.</code></pre>
<p>If we had another index then we would use <span class="math inline">\(2 ^ 3\)</span> (i.e. 8) to flag a problem in that
index.</p>
<p>The advantage of using this coding scheme is that it compactly codes
all possible combinations of problems in a single variable (see table
below).</p>
<p>There are a number of flagged records in the example dataset.
This:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span><span class="op">)</span></span></code></pre></div>
<p>returns:</p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   0   1   2   3   5   6 </span></span>
<span><span class="co">#&gt; 751   9  12   9   2   3</span></span></code></pre>
<p>This table shows the relative frequency of detected problems. See
table below to find the meaning of each of the codes.</p>
<p> </p>
<table class="table table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Flagging codes based on powers of two and their meanings
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Problem detected with …
</div>
</th>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
</tr>
<tr>
<th style="text-align:right;">
Code
</th>
<th style="text-align:left;">
HAZ
</th>
<th style="text-align:left;">
WHZ
</th>
<th style="text-align:left;">
WAZ
</th>
<th style="text-align:left;">
Suggested action(s)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
O
</td>
<td style="text-align:left;">
O
</td>
<td style="text-align:left;">
O
</td>
<td style="text-align:left;">
None
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
X
</td>
<td style="text-align:left;">
O
</td>
<td style="text-align:left;">
O
</td>
<td style="text-align:left;">
Check height and age
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
O
</td>
<td style="text-align:left;">
X
</td>
<td style="text-align:left;">
O
</td>
<td style="text-align:left;">
Check weight and height
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
X
</td>
<td style="text-align:left;">
X
</td>
<td style="text-align:left;">
O
</td>
<td style="text-align:left;">
Check height
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
O
</td>
<td style="text-align:left;">
O
</td>
<td style="text-align:left;">
X
</td>
<td style="text-align:left;">
Check weight and age
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
X
</td>
<td style="text-align:left;">
O
</td>
<td style="text-align:left;">
X
</td>
<td style="text-align:left;">
Check age
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
O
</td>
<td style="text-align:left;">
X
</td>
<td style="text-align:left;">
X
</td>
<td style="text-align:left;">
Check weight
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
X
</td>
<td style="text-align:left;">
X
</td>
<td style="text-align:left;">
X
</td>
<td style="text-align:left;">
Check age, height, and weight
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>The number of flagged records can be found using:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">[</span><span class="st">"TRUE"</span><span class="op">]</span></span></code></pre></div>
<p>which returns:</p>
<pre><code><span><span class="co">#&gt; TRUE </span></span>
<span><span class="co">#&gt;   35</span></span></code></pre>
<p>The proportion of records that are flagged can be found using:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"TRUE"</span><span class="op">]</span></span></code></pre></div>
<p>This returns:</p>
<pre><code><span><span class="co">#&gt;       TRUE </span></span>
<span><span class="co">#&gt; 0.04452926</span></span></code></pre>
<p>About 4.45% of records are flagged.</p>
<p>Note that missing values are not flagged. It can be useful to check
missing values to see if there are missing component measurements or if
a component measurement is out of range for the calculation of index
values (e.g. WAZ is only calculated for children aged ten years or
younger). This issue can be explored by selection and listing. For
example:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">whz</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weight"</span>, <span class="st">"height"</span>, <span class="st">"whz"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>This returns:</p>
<pre><code><span><span class="co">#&gt;   weight height whz</span></span>
<span><span class="co">#&gt; 8    8.1     NA  NA</span></span></code></pre>
<p>There is one missing value for <strong>whz</strong> in record
<strong>8</strong>.This is due to a missing value for
<strong>height</strong> (shown as <strong>NA</strong>). and
<strong>haz</strong> will also be missing. It may be possible to fix
this issue if the missing data are available on paper forms.</p>
<p>Flagging has a dual role:</p>
<ol style="list-style-type: decimal">
<li><p>It is a data-checking tool. If you have access to data collection
forms you will be often able to check records and fix data-entry errors
in the data.</p></li>
<li><p>It is a measure of data-quality. Flagged records can indicate
problems with measurement, recording, data-entry, and data-checking. The
proportion of flagged records in a dataset should, ideally, be below
about 2.5%. SMART guidelines consider proportions above 7.5% to be
problematic. We found that 4.45% of records in the example dataset were
flagged. The data are of acceptable quality.</p></li>
</ol>
<p>We can use:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">[</span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">!=</span> <span class="fl">0</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;     psu child age sex weight height muac oedema   haz   waz   whz flag</span></span>
<span><span class="co">#&gt; 1     1     1  20   2    6.1   82.5  127      2 -0.07 -4.54 -6.03    2</span></span>
<span><span class="co">#&gt; 29    1    29  24   2   16.3  107.3  155      2  6.69  2.69 -0.82    1</span></span>
<span><span class="co">#&gt; 32    2     1  12   1    6.1   99.4  112      2  9.95 -4.02 -9.18    3</span></span>
<span><span class="co">#&gt; 35    2     4  24   2    6.8   65.5  128      2 -6.27 -4.30 -0.63    1</span></span>
<span><span class="co">#&gt; 88    3    30  24   2   16.9  107.5  158      2  6.75  2.95 -0.47    1</span></span>
<span><span class="co">#&gt; 106   4    18  36   1   13.4   65.7  152      2 -8.20 -0.56  7.64    3</span></span>
<span><span class="co">#&gt; 174   7     3  36   2    6.8   66.6  134      2 -7.47 -5.35 -1.01    1</span></span>
<span><span class="co">#&gt; 198   8     1  27   2    5.5   66.0  112      2 -6.59 -5.92 -3.27    1</span></span>
<span><span class="co">#&gt; 280  11     7  24   1    6.7   81.7  140      2 -1.77 -4.86 -5.63    2</span></span>
<span><span class="co">#&gt; 286  11    13  48   1    9.4   77.3  146      2 -6.21 -4.25 -0.69    1</span></span>
<span><span class="co">#&gt; 292  11    19  12   1   12.9   92.3  152      2  6.97  2.68 -0.50    1</span></span>
<span><span class="co">#&gt; 307  12     3  36   1    7.5   90.0  130      2 -1.64 -4.99 -6.42    2</span></span>
<span><span class="co">#&gt; 350  14     1  20   1    5.7   77.8  142      2 -2.27 -5.49 -6.47    2</span></span>
<span><span class="co">#&gt; 352  14     3  48   1    6.5   80.7  140      2 -5.40 -6.22 -5.74    6</span></span>
<span><span class="co">#&gt; 368  14    19  48   1   13.4   66.3  144      2 -8.83 -1.58  7.33    3</span></span>
<span><span class="co">#&gt; 399  15    21  36   1   14.3   66.0  154      2 -8.12 -0.02  8.58    3</span></span>
<span><span class="co">#&gt; 400  15    22  48   1   14.5   68.0  152      2 -8.42 -0.95  7.80    3</span></span>
<span><span class="co">#&gt; 405  16     4  24   2    7.8   65.0  145      2 -6.42 -3.27  1.04    1</span></span>
<span><span class="co">#&gt; 406  16     5  12   1    7.8   98.0  138      2  9.36 -1.93 -7.23    3</span></span>
<span><span class="co">#&gt; 408  16     7  48   1    8.0   77.0  128      2 -6.28 -5.20 -2.66    1</span></span>
<span><span class="co">#&gt; 432  17     3   6   1    7.9   98.4  138      2 14.38 -0.04 -7.18    3</span></span>
<span><span class="co">#&gt; 433  17     4  48   2    8.3   94.9  136      2 -1.82 -4.79 -5.63    2</span></span>
<span><span class="co">#&gt; 490  19     1  12   2    5.3   72.0  152      2 -0.78 -4.27 -5.30    2</span></span>
<span><span class="co">#&gt; 591  22    24  36   1   14.0   69.0  152      2 -7.31 -0.20  6.77    3</span></span>
<span><span class="co">#&gt; 594  23     1  36   1    5.4   80.0  140      2 -4.34 -6.66 -7.27    6</span></span>
<span><span class="co">#&gt; 595  23     2  36   1    5.9   72.0  114      2 -6.50 -6.26 -4.96    5</span></span>
<span><span class="co">#&gt; 596  23     3  24   1    6.3   77.0  130      2 -3.31 -5.24 -5.38    2</span></span>
<span><span class="co">#&gt; 599  23     6  36   1    6.5   80.0  130      2 -4.34 -5.79 -5.61    2</span></span>
<span><span class="co">#&gt; 616  23    23  36   1   16.0   74.0  144      2 -5.96  0.90  6.82    2</span></span>
<span><span class="co">#&gt; 640  25     1  12   2    6.3   99.3  110      2  9.82 -2.96 -8.25    3</span></span>
<span><span class="co">#&gt; 641  25     2  48   2    6.7   85.0  140      2 -4.12 -5.90 -5.83    2</span></span>
<span><span class="co">#&gt; 671  26     1  48   1    5.3   95.0  135      2 -1.99 -7.03 -9.71    6</span></span>
<span><span class="co">#&gt; 690  26    20  36   1   16.0   79.0  162      2 -4.61  0.90  5.34    2</span></span>
<span><span class="co">#&gt; 715  28     4  36   2    7.7  103.0  114      2  2.09 -4.60 -7.31    2</span></span>
<span><span class="co">#&gt; 757  30     1  24   1    5.5   68.6  106      2 -6.06 -6.01 -4.76    5</span></span></code></pre></div>
<p>to display the flagged records.</p>
<p>This:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">[</span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">!=</span> <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"psu"</span>, <span class="st">"child"</span>, <span class="st">"flag"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;     psu child flag</span></span>
<span><span class="co">#&gt; 1     1     1    2</span></span>
<span><span class="co">#&gt; 29    1    29    1</span></span>
<span><span class="co">#&gt; 32    2     1    3</span></span>
<span><span class="co">#&gt; 35    2     4    1</span></span>
<span><span class="co">#&gt; 88    3    30    1</span></span>
<span><span class="co">#&gt; 106   4    18    3</span></span>
<span><span class="co">#&gt; 174   7     3    1</span></span>
<span><span class="co">#&gt; 198   8     1    1</span></span>
<span><span class="co">#&gt; 280  11     7    2</span></span>
<span><span class="co">#&gt; 286  11    13    1</span></span>
<span><span class="co">#&gt; 292  11    19    1</span></span>
<span><span class="co">#&gt; 307  12     3    2</span></span>
<span><span class="co">#&gt; 350  14     1    2</span></span>
<span><span class="co">#&gt; 352  14     3    6</span></span>
<span><span class="co">#&gt; 368  14    19    3</span></span>
<span><span class="co">#&gt; 399  15    21    3</span></span>
<span><span class="co">#&gt; 400  15    22    3</span></span>
<span><span class="co">#&gt; 405  16     4    1</span></span>
<span><span class="co">#&gt; 406  16     5    3</span></span>
<span><span class="co">#&gt; 408  16     7    1</span></span>
<span><span class="co">#&gt; 432  17     3    3</span></span>
<span><span class="co">#&gt; 433  17     4    2</span></span>
<span><span class="co">#&gt; 490  19     1    2</span></span>
<span><span class="co">#&gt; 591  22    24    3</span></span>
<span><span class="co">#&gt; 594  23     1    6</span></span>
<span><span class="co">#&gt; 595  23     2    5</span></span>
<span><span class="co">#&gt; 596  23     3    2</span></span>
<span><span class="co">#&gt; 599  23     6    2</span></span>
<span><span class="co">#&gt; 616  23    23    2</span></span>
<span><span class="co">#&gt; 640  25     1    3</span></span>
<span><span class="co">#&gt; 641  25     2    2</span></span>
<span><span class="co">#&gt; 671  26     1    6</span></span>
<span><span class="co">#&gt; 690  26    20    2</span></span>
<span><span class="co">#&gt; 715  28     4    2</span></span>
<span><span class="co">#&gt; 757  30     1    5</span></span></code></pre></div>
<p>produces a more compact list.</p>
<p>In the example dataset records are identified using a combination of
the <strong>psu</strong> and <strong>child</strong> variables.</p>
<p>The listed records can be checked and edited (see previous table).
Anthropometric indices can then be recalculated and the flagging process
repeated until all records that can be fixed have been fixed.</p>
<p>Records that cannot be fixed can be censored during analysis. Records
are usually censored on an index-by-index basis. For example, an
analysis based on WHZ would censor records in which the flag variable is
2, 3, 6, or 7.</p>
<p>Table below shows censoring rules for each index:</p>
<p> </p>
<table class="table table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Censoring rules for each index
</caption>
<thead><tr>
<th style="text-align:center;">
Analysis uses …
</th>
<th style="text-align:center;">
Censor if flag code is …
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
HAZ
</td>
<td style="text-align:center;">
1, 3, 5, or 7
</td>
</tr>
<tr>
<td style="text-align:center;">
WHZ
</td>
<td style="text-align:center;">
2, 3, 6, or 7
</td>
</tr>
<tr>
<td style="text-align:center;">
WAZ
</td>
<td style="text-align:center;">
4, 5, 6, or 7
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>You should be very careful when applying censoring rules. An analysis
of prevalence using WHZ, for example, will usually include children with
oedema because a commonly used case-definition for acute malnutrition
is:</p>
<p><span class="math display">\[ \text{WHZ} &lt; -2 ~ \text{or bilateral
pitting oedema} \]</span></p>
<p>If you want to use case-definitions that include oedema then you
should be careful not to exclude children with oedema when censoring
flagged records. For an analysis using WAZ you might want to exclude
oedema cases.</p>
</div>
<div class="section level2">
<h2 id="applying-smart-flagging-criteria-to-survey-data">Applying SMART flagging criteria to survey data<a class="anchor" aria-label="anchor" href="#applying-smart-flagging-criteria-to-survey-data"></a>
</h2>
<p>In the next exercise we will apply SMART flagging criteria to the
same survey dataset.</p>
<p>We will retrieve the survey dataset:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="st">"flag.ex01.csv"</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;   psu child age sex weight height muac oedema   haz   waz   whz</span></span>
<span><span class="co">#&gt; 1   1     1  20   2    6.1   82.5  127      2 -0.07 -4.54 -6.03</span></span>
<span><span class="co">#&gt; 2   1     2  13   2    6.4   70.4  116      2 -1.83 -3.04 -2.93</span></span>
<span><span class="co">#&gt; 3   1     3  15   1    7.1   67.5  124      2 -4.60 -3.34 -1.25</span></span>
<span><span class="co">#&gt; 4   1     4  15   1    7.2   75.4  130      2 -1.48 -3.22 -3.57</span></span>
<span><span class="co">#&gt; 5   1     5  15   1    7.4   70.0  124      2 -3.61 -2.99 -1.61</span></span>
<span><span class="co">#&gt; 6   1     6  18   2    7.7   70.6  130      2 -3.48 -2.40 -0.82</span></span></code></pre>
<p>and create a column that will contain the flag code and set this to
zero (i.e. no flags) for all records:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></code></pre></div>
<p>Applying SMART flagging criteria requires us to first calculate a
mean index value:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meanHAZ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">haz</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>and then to use this mean value to define flagging ranges:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">haz</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>              <span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">haz</span> <span class="op">&lt;</span> <span class="op">(</span><span class="va">meanHAZ</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|</span> <span class="va">svy</span><span class="op">$</span><span class="va">haz</span> <span class="op">&gt;</span> <span class="op">(</span><span class="va">meanHAZ</span> <span class="op">+</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>, </span>
<span>              <span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">svy</span><span class="op">$</span><span class="va">flag</span><span class="op">)</span></span></code></pre></div>
<p>We do this for each index:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">meanWHZ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">whz</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">whz</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>              <span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">whz</span> <span class="op">&lt;</span> <span class="op">(</span><span class="va">meanWHZ</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|</span> <span class="va">svy</span><span class="op">$</span><span class="va">whz</span> <span class="op">&gt;</span> <span class="op">(</span><span class="va">meanWHZ</span> <span class="op">+</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              <span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">+</span> <span class="fl">2</span>, <span class="va">svy</span><span class="op">$</span><span class="va">flag</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">meanWAZ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">waz</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">waz</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>              <span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">waz</span> <span class="op">&lt;</span> <span class="op">(</span><span class="va">meanWAZ</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|</span> <span class="va">svy</span><span class="op">$</span><span class="va">waz</span> <span class="op">&gt;</span> <span class="op">(</span><span class="va">meanWAZ</span> <span class="op">+</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              <span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">+</span> <span class="fl">4</span>, <span class="va">svy</span><span class="op">$</span><span class="va">flag</span><span class="op">)</span></span></code></pre></div>
<p>There are a number of flagged records in the example dataset.</p>
<p>This:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span><span class="op">)</span></span></code></pre></div>
<p>returns:</p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   0   1   2   3   4   5   6   7 </span></span>
<span><span class="co">#&gt; 660  59  11  16   1  19  16   4</span></span></code></pre>
<p>This table shows the relative frequency of detected problems. See the
previous table to find the meaning of each of the codes. The number of
flagged records can be found using:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">[</span><span class="st">"TRUE"</span><span class="op">]</span></span></code></pre></div>
<p>which returns:</p>
<pre><code><span><span class="co">#&gt; TRUE </span></span>
<span><span class="co">#&gt;  126</span></span></code></pre>
<p>The proportion of records that are flagged can be found using:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"TRUE"</span><span class="op">]</span></span></code></pre></div>
<p>which returns:</p>
<pre><code><span><span class="co">#&gt;      TRUE </span></span>
<span><span class="co">#&gt; 0.1603053</span></span></code></pre>
<p>About 16% of records are flagged. This is a very high proportion of
records flagged.</p>
<p>Note how the SMART flagging criteria identify considerably more
records (126 records flagged) than the WHO flagging criteria (35 records
flagged). In this example the SMART flagging criteria flagged 91
<em>biologically plausible</em> records.</p>
<p>We can list flagged records using:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">[</span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">!=</span> <span class="fl">0</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;     psu child age sex weight height muac oedema   haz   waz   whz flag</span></span>
<span><span class="co">#&gt; 1     1     1  20   2    6.1   82.5  127      2 -0.07 -4.54 -6.03    2</span></span>
<span><span class="co">#&gt; 3     1     3  15   1    7.1   67.5  124      2 -4.60 -3.34 -1.25    1</span></span>
<span><span class="co">#&gt; 15    1    15  36   1   12.3   79.7  144      2 -4.42 -1.27  1.97    3</span></span>
<span><span class="co">#&gt; 28    1    28  48   2   15.8  109.7  146      2  1.62 -0.12 -1.72    1</span></span>
<span><span class="co">#&gt; 29    1    29  24   2   16.3  107.3  155      2  6.69  2.69 -0.82    5</span></span>
<span><span class="co">#&gt; 31    1    31  48   2   18.8  109.9  166      2  1.66  1.10  0.13    1</span></span>
<span><span class="co">#&gt; 32    2     1  12   1    6.1   99.4  112      2  9.95 -4.02 -9.18    3</span></span>
<span><span class="co">#&gt; 34    2     3  24   2    6.5   76.0  108      2 -3.01 -4.61 -4.16    6</span></span>
<span><span class="co">#&gt; 35    2     4  24   2    6.8   65.5  128      2 -6.27 -4.30 -0.63    1</span></span>
<span><span class="co">#&gt; 36    2     5  36   1    7.3   76.0  110      2 -5.42 -5.15 -3.56    5</span></span>
<span><span class="co">#&gt; 42    2    11  12   2    9.9   80.0  150      2  2.32  0.82 -0.21    1</span></span>
<span><span class="co">#&gt; 44    2    13  36   2   10.5   78.0  142      2 -4.48 -2.24  0.87    1</span></span>
<span><span class="co">#&gt; 52    2    21  36   1   12.7   77.5  144      2 -5.01 -1.01  2.77    3</span></span>
<span><span class="co">#&gt; 57    2    26  24   1   15.5   93.7  166      2  2.16  2.13  1.46    5</span></span>
<span><span class="co">#&gt; 59    3     1  18   2    5.7   67.0  110      2 -4.72 -4.72 -3.21    5</span></span>
<span><span class="co">#&gt; 66    3     8  48   2    9.4   79.0  144      2 -5.51 -4.03 -0.57    1</span></span>
<span><span class="co">#&gt; 76    3    18  24   2   12.1   96.0  138      2  3.19  0.42 -1.79    1</span></span>
<span><span class="co">#&gt; 88    3    30  24   2   16.9  107.5  158      2  6.75  2.95 -0.47    5</span></span>
<span><span class="co">#&gt; 89    4     1  26   2    6.6   71.7  114      2 -4.73 -4.74 -2.95    5</span></span>
<span><span class="co">#&gt; 106   4    18  36   1   13.4   65.7  152      2 -8.20 -0.56  7.64    3</span></span>
<span><span class="co">#&gt; 107   4    19  24   1   13.7   97.6  150      2  3.43  1.05 -0.89    1</span></span>
<span><span class="co">#&gt; 122   5     4  24   1    8.0   73.3  130      2 -4.52 -3.61 -1.66    1</span></span>
<span><span class="co">#&gt; 125   5     7  36   2   11.3  106.2  150      2  2.93 -1.63 -4.61    3</span></span>
<span><span class="co">#&gt; 139   5    21  24   2   15.2   82.0  138      2 -1.15  2.18  3.97    6</span></span>
<span><span class="co">#&gt; 154   6    14  24   2   11.9   91.0  148      2  1.64  0.29 -0.91    1</span></span>
<span><span class="co">#&gt; 165   6    25  36   1   14.9  108.0  144      2  3.21  0.31 -2.13    1</span></span>
<span><span class="co">#&gt; 173   7     2  10   2    6.5   76.2  122      2  1.91 -2.23 -4.20    3</span></span>
<span><span class="co">#&gt; 174   7     3  36   2    6.8   66.6  134      2 -7.47 -5.35 -1.01    5</span></span>
<span><span class="co">#&gt; 187   7    16  10   2   11.6   84.3  152      2  5.19  2.50  0.54    5</span></span>
<span><span class="co">#&gt; 198   8     1  27   2    5.5   66.0  112      2 -6.59 -5.92 -3.27    5</span></span>
<span><span class="co">#&gt; 199   8     2  24   2    6.4   75.0  138      2 -3.32 -4.72 -4.10    6</span></span>
<span><span class="co">#&gt; 201   8     4  24   1    7.1   70.5  122      2 -5.44 -4.47 -2.31    1</span></span>
<span><span class="co">#&gt; 203   8     6  31   1    8.5   72.9  134      2 -5.71 -3.83 -0.79    1</span></span>
<span><span class="co">#&gt; 205   8     8  36   2    9.4   78.0  146      2 -4.48 -3.18 -0.35    1</span></span>
<span><span class="co">#&gt; 212   8    15  48   1   11.4  102.5  126      2 -0.20 -2.88 -4.22    2</span></span>
<span><span class="co">#&gt; 254   9    30  42   1   17.9  109.4  164      2  2.41  1.23 -0.26    1</span></span>
<span><span class="co">#&gt; 255  10     1  23   1    6.7   71.0  118      2 -5.32 -4.76 -3.23    5</span></span>
<span><span class="co">#&gt; 274  11     1  24   2    5.8   71.9  108      2 -4.28 -5.34 -4.40    6</span></span>
<span><span class="co">#&gt; 280  11     7  24   1    6.7   81.7  140      2 -1.77 -4.86 -5.63    6</span></span>
<span><span class="co">#&gt; 283  11    10  36   1    8.5   78.3  126      2 -4.80 -4.20 -2.19    1</span></span>
<span><span class="co">#&gt; 286  11    13  48   1    9.4   77.3  146      2 -6.21 -4.25 -0.69    1</span></span>
<span><span class="co">#&gt; 290  11    17  24   2   12.4   99.9  136      2  4.40  0.62 -2.33    1</span></span>
<span><span class="co">#&gt; 292  11    19  12   1   12.9   92.3  152      2  6.97  2.68 -0.50    5</span></span>
<span><span class="co">#&gt; 301  11    28  24   2   15.1   85.3  140      2 -0.13  2.13  2.94    6</span></span>
<span><span class="co">#&gt; 302  11    29  30   1   15.2   82.9  154      2 -2.65  1.13  3.76    2</span></span>
<span><span class="co">#&gt; 303  11    30  48   2   15.8   90.5  132      2 -2.84 -0.12  2.29    2</span></span>
<span><span class="co">#&gt; 307  12     3  36   1    7.5   90.0  130      2 -1.64 -4.99 -6.42    6</span></span>
<span><span class="co">#&gt; 313  12     9  12   1   10.0   81.0  150      2  2.21  0.33 -0.75    1</span></span>
<span><span class="co">#&gt; 315  12    11  48   1   10.6   84.0  142      2 -4.61 -3.43 -0.75    1</span></span>
<span><span class="co">#&gt; 330  13     3  24   1    7.7   73.0  114      2 -4.62 -3.90 -2.06    1</span></span>
<span><span class="co">#&gt; 340  13    13  12   2   11.1   79.0  152      2  1.94  1.72  1.26    5</span></span>
<span><span class="co">#&gt; 345  13    18  24   1   13.3   96.1  142      2  2.94  0.79 -0.93    1</span></span>
<span><span class="co">#&gt; 350  14     1  20   1    5.7   77.8  142      2 -2.27 -5.49 -6.47    6</span></span>
<span><span class="co">#&gt; 352  14     3  48   1    6.5   80.7  140      2 -5.40 -6.22 -5.74    7</span></span>
<span><span class="co">#&gt; 366  14    17  24   1   12.7   92.3  185      2  1.70  0.39 -0.70    1</span></span>
<span><span class="co">#&gt; 368  14    19  48   1   13.4   66.3  144      2 -8.83 -1.58  7.33    3</span></span>
<span><span class="co">#&gt; 379  15     1  12   1    5.1   66.0  106      2 -4.10 -5.24 -4.75    6</span></span>
<span><span class="co">#&gt; 395  15    17  24   1   13.1   80.0  144      2 -2.33  0.66  2.62    2</span></span>
<span><span class="co">#&gt; 399  15    21  36   1   14.3   66.0  154      2 -8.12 -0.02  8.58    3</span></span>
<span><span class="co">#&gt; 400  15    22  48   1   14.5   68.0  152      2 -8.42 -0.95  7.80    3</span></span>
<span><span class="co">#&gt; 403  16     2  24   1    7.0   74.0  130      2 -4.29 -4.57 -3.56    4</span></span>
<span><span class="co">#&gt; 405  16     4  24   2    7.8   65.0  145      2 -6.42 -3.27  1.04    1</span></span>
<span><span class="co">#&gt; 406  16     5  12   1    7.8   98.0  138      2  9.36 -1.93 -7.23    3</span></span>
<span><span class="co">#&gt; 408  16     7  48   1    8.0   77.0  128      2 -6.28 -5.20 -2.66    5</span></span>
<span><span class="co">#&gt; 432  17     3   6   1    7.9   98.4  138      2 14.38 -0.04 -7.18    3</span></span>
<span><span class="co">#&gt; 433  17     4  48   2    8.3   94.9  136      2 -1.82 -4.79 -5.63    6</span></span>
<span><span class="co">#&gt; 435  17     6   9   1    8.8   77.7  136      2  2.55 -0.11 -1.61    1</span></span>
<span><span class="co">#&gt; 448  17    19  36   1   13.9  105.0  138      2  2.41 -0.26 -2.34    1</span></span>
<span><span class="co">#&gt; 449  17    20  36   2   14.4  107.5  162      2  3.27  0.30 -2.27    1</span></span>
<span><span class="co">#&gt; 460  17    31  48   1   18.5   96.2  170      2 -1.70  0.96  3.00    2</span></span>
<span><span class="co">#&gt; 462  18     2   7   1    7.6   76.5  146      2  3.38 -0.80 -3.19    1</span></span>
<span><span class="co">#&gt; 464  18     4  23   1    8.0   73.4  134      2 -4.52 -3.49 -1.69    1</span></span>
<span><span class="co">#&gt; 468  18     8  36   1    9.3   77.6  140      2 -4.99 -3.57 -0.89    1</span></span>
<span><span class="co">#&gt; 483  18    23  24   1   15.8  102.5  146      2  5.04  2.29 -0.21    5</span></span>
<span><span class="co">#&gt; 489  18    29  48   2   19.2  109.9  164      2  1.66  1.24  0.35    1</span></span>
<span><span class="co">#&gt; 490  19     1  12   2    5.3   72.0  152      2 -0.78 -4.27 -5.30    2</span></span>
<span><span class="co">#&gt; 499  19    10  48   1   10.0   84.2  140      2 -4.56 -3.84 -1.53    1</span></span>
<span><span class="co">#&gt; 508  19    19  24   1   13.7   98.0  180      2  3.56  1.05 -0.97    1</span></span>
<span><span class="co">#&gt; 510  19    21  24   1   13.9   92.7  152      2  1.83  1.18  0.35    1</span></span>
<span><span class="co">#&gt; 512  19    23  36   2   15.8  101.5  174      2  1.69  1.00  0.09    1</span></span>
<span><span class="co">#&gt; 519  20     7  18   1    9.4   69.5  140      2 -4.73 -1.36  1.47    1</span></span>
<span><span class="co">#&gt; 528  20    16  24   2   12.5   91.5  146      2  1.79  0.68 -0.46    1</span></span>
<span><span class="co">#&gt; 530  20    18  24   2   13.2   91.2  160      2  1.70  1.11  0.22    1</span></span>
<span><span class="co">#&gt; 536  20    24  48   2   17.5  109.9  154      2  1.66  0.61 -0.63    1</span></span>
<span><span class="co">#&gt; 537  20    25  36   1   18.1  109.3  162      2  3.57  1.90 -0.11    5</span></span>
<span><span class="co">#&gt; 557  21    19  24   2   11.4   92.0  138      2  1.95 -0.05 -1.64    1</span></span>
<span><span class="co">#&gt; 587  22    20  36   2   12.7   80.4  154      2 -3.85 -0.68  2.38    2</span></span>
<span><span class="co">#&gt; 591  22    24  36   1   14.0   69.0  152      2 -7.31 -0.20  6.77    3</span></span>
<span><span class="co">#&gt; 594  23     1  36   1    5.4   80.0  140      2 -4.34 -6.66 -7.27    6</span></span>
<span><span class="co">#&gt; 595  23     2  36   1    5.9   72.0  114      2 -6.50 -6.26 -4.96    7</span></span>
<span><span class="co">#&gt; 596  23     3  24   1    6.3   77.0  130      2 -3.31 -5.24 -5.38    6</span></span>
<span><span class="co">#&gt; 598  23     5  24   2    6.5   71.0  124      2 -4.56 -4.61 -2.93    5</span></span>
<span><span class="co">#&gt; 599  23     6  36   1    6.5   80.0  130      2 -4.34 -5.79 -5.61    6</span></span>
<span><span class="co">#&gt; 600  23     7  24   2    7.0   70.0  112      2 -4.87 -4.10 -1.75    1</span></span>
<span><span class="co">#&gt; 604  23    11  14   1    8.0   66.0  136      2 -4.86 -2.11  0.77    1</span></span>
<span><span class="co">#&gt; 607  23    14  36   1    8.3   74.0  138      2 -5.96 -4.36 -1.40    1</span></span>
<span><span class="co">#&gt; 612  23    19  48   1   11.5   80.0  144      2 -5.56 -2.81  1.14    1</span></span>
<span><span class="co">#&gt; 616  23    23  36   1   16.0   74.0  144      2 -5.96  0.90  6.82    3</span></span>
<span><span class="co">#&gt; 621  24     5  24   1    8.4   72.2  140      2 -4.88 -3.22 -0.73    1</span></span>
<span><span class="co">#&gt; 633  24    17  24   2   12.9   93.2  152      2  2.32  0.93 -0.46    1</span></span>
<span><span class="co">#&gt; 640  25     1  12   2    6.3   99.3  110      2  9.82 -2.96 -8.25    3</span></span>
<span><span class="co">#&gt; 641  25     2  48   2    6.7   85.0  140      2 -4.12 -5.90 -5.83    6</span></span>
<span><span class="co">#&gt; 649  25    10  36   2    8.6   78.0  134      2 -4.48 -3.85 -1.38    1</span></span>
<span><span class="co">#&gt; 661  25    22  24   2   12.4   91.0  140      2  1.64  0.62 -0.44    1</span></span>
<span><span class="co">#&gt; 671  26     1  48   1    5.3   95.0  135      2 -1.99 -7.03 -9.71    6</span></span>
<span><span class="co">#&gt; 672  26     2  18   2    5.6   67.0  108      2 -4.72 -4.84 -3.41    5</span></span>
<span><span class="co">#&gt; 674  26     4  36   1    8.0   76.0  134      2 -5.42 -4.60 -2.40    5</span></span>
<span><span class="co">#&gt; 679  26     9  48   1   10.5   82.0  142      2 -5.09 -3.50 -0.38    1</span></span>
<span><span class="co">#&gt; 683  26    13  24   1   13.8   75.0  156      2 -3.97  1.11  4.39    2</span></span>
<span><span class="co">#&gt; 685  26    15  24   1   14.3   85.0  168      2 -0.69  1.42  2.40    2</span></span>
<span><span class="co">#&gt; 689  26    19  36   1   15.8  104.0  148      2  2.14  0.80 -0.54    1</span></span>
<span><span class="co">#&gt; 690  26    20  36   1   16.0   79.0  162      2 -4.61  0.90  5.34    3</span></span>
<span><span class="co">#&gt; 692  27     2  24   2    7.1   68.2  124      2 -5.43 -4.00 -1.04    1</span></span>
<span><span class="co">#&gt; 698  27     8  36   2    8.4   75.4  124      2 -5.16 -4.01 -1.06    1</span></span>
<span><span class="co">#&gt; 715  28     4  36   2    7.7  103.0  114      2  2.09 -4.60 -7.31    7</span></span>
<span><span class="co">#&gt; 721  28    10  48   1   10.3   82.0  148      2 -5.09 -3.64 -0.61    1</span></span>
<span><span class="co">#&gt; 723  28    12  15   1   11.0   73.0  162      2 -2.43  0.59  2.24    2</span></span>
<span><span class="co">#&gt; 733  29     1  16   1    5.9   69.2  112      2 -4.26 -4.85 -4.17    6</span></span>
<span><span class="co">#&gt; 734  29     2  17   1    6.1   69.3  114      2 -4.53 -4.75 -3.81    5</span></span>
<span><span class="co">#&gt; 745  29    13  24   1   11.0   70.3  114      2 -5.50 -0.87  3.01    3</span></span>
<span><span class="co">#&gt; 757  30     1  24   1    5.5   68.6  106      2 -6.06 -6.01 -4.76    7</span></span>
<span><span class="co">#&gt; 767  30    11  36   2   10.2   77.5  142      2 -4.61 -2.49  0.66    1</span></span>
<span><span class="co">#&gt; 781  30    25  24   2   13.3   91.5  152      2  1.79  1.16  0.24    1</span></span>
<span><span class="co">#&gt; 783  30    27  36   1   14.2  102.3  138      2  1.68 -0.08 -1.48    1</span></span>
<span><span class="co">#&gt; 784  30    28  36   1   14.6  106.1  154      2  2.70  0.15 -1.97    1</span></span>
<span><span class="co">#&gt; 786  30    30  36   2   15.5  101.2  154      2  1.61  0.86 -0.05    1</span></span></code></pre></div>
<p>The listed records can be checked and edited (see previous table).
Anthropometric indices can then be recalculated and the flagging process
repeated until all records that can be fixed have been fixed.</p>
<p>When listing records or displaying very large tables you may see a
message like this:</p>
<pre><code><span><span class="co">#&gt; [1] "[ reached getOption(\"max.print\") -- omitted 43 rows ]"</span></span></code></pre>
<p>The <strong>max.print</strong> option sets a limit on the length of
information that can be displayed by a single command. You can alter
this behaviour using:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>max.print <span class="op">=</span> <span class="fl">99999</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="flagging-data-from-older-children">Flagging data from older children<a class="anchor" aria-label="anchor" href="#flagging-data-from-older-children"></a>
</h2>
<p>The process of flagging anthropometric indices in older children is
very similar to that used with younger children.</p>
<p>We will retrieve a survey dataset:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="st">"flag.ex02.csv"</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">#&gt;   school sex ageMonths weight height   haz   baz</span></span>
<span><span class="co">#&gt; 1   1112   1       173   25.5  179.0  1.70 -8.19</span></span>
<span><span class="co">#&gt; 2   1113   2       145   22.7  164.0  1.79 -6.81</span></span>
<span><span class="co">#&gt; 3   1116   1       150   13.5  135.0 -2.40 -8.64</span></span>
<span><span class="co">#&gt; 4   1123   1       150   25.3  165.0  1.73 -6.92</span></span>
<span><span class="co">#&gt; 5   1404   2       163   19.0  116.5 -6.05 -2.89</span></span>
<span><span class="co">#&gt; 6   1501   2       185   27.4  136.6 -3.73 -2.85</span></span></code></pre>
<p>The file <strong>flag.ex02.csv</strong> is a comma-separated-value
(CSV) file containing anthropometric data from a survey of children aged
11 year or older and attending school in Ethiopia.</p>
<p>The variables of interest are height-for-age z-score
(<strong>haz</strong>) and BMI-for-age z-score (<strong>baz</strong>).
We will apply the WHO flagging criteria (see previous table) to these
variables:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">haz</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">haz</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">6</span> <span class="op">|</span> <span class="va">svy</span><span class="op">$</span><span class="va">haz</span> <span class="op">&gt;</span> <span class="fl">6</span><span class="op">)</span>, </span>
<span>              <span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">svy</span><span class="op">$</span><span class="va">flag</span><span class="op">)</span></span>
<span></span>
<span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">baz</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">baz</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">5</span> <span class="op">|</span> <span class="va">svy</span><span class="op">$</span><span class="va">baz</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span>, </span>
<span>              <span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">+</span> <span class="fl">2</span>, <span class="va">svy</span><span class="op">$</span><span class="va">flag</span><span class="op">)</span></span></code></pre></div>
<p>Note that we do not usually apply SMART flagging criteria to older
(i.e. &gt; 59 months) children.</p>
<p>The coding of the flag variable is shown in previous table.</p>
<table class="table table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Flagging codes based on powers of two and their meanings
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Problem with …
</div>
</th>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
</tr>
<tr>
<th style="text-align:right;">
Code
</th>
<th style="text-align:left;">
HAZ
</th>
<th style="text-align:left;">
BAZ
</th>
<th style="text-align:left;">
Suggested action(s)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
O
</td>
<td style="text-align:left;">
O
</td>
<td style="text-align:left;">
None
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
X
</td>
<td style="text-align:left;">
O
</td>
<td style="text-align:left;">
Check height and age
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
O
</td>
<td style="text-align:left;">
X
</td>
<td style="text-align:left;">
Check weight, height and age
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
X
</td>
<td style="text-align:left;">
X
</td>
<td style="text-align:left;">
Check weight, height and age
</td>
</tr>
</tbody>
</table>
<p>This:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span><span class="op">)</span></span></code></pre></div>
<p>returns:</p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   0   1   2 </span></span>
<span><span class="co">#&gt; 960   2  11</span></span></code></pre>
<p>This table shows the relative frequency of detected problems. See
previous table to find the meaning of each of the codes. The number of
flagged records can be found using:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">[</span><span class="st">"TRUE"</span><span class="op">]</span></span></code></pre></div>
<p>which returns:</p>
<pre><code><span><span class="co">#&gt; TRUE </span></span>
<span><span class="co">#&gt;   13</span></span></code></pre>
<p>The proportion of records that are flagged can be found using:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"TRUE"</span><span class="op">]</span></span></code></pre></div>
<p>which returns:</p>
<pre><code><span><span class="co">#&gt;       TRUE </span></span>
<span><span class="co">#&gt; 0.01336074</span></span></code></pre>
<p>About 1.3% of records are flagged. This is an acceptably low
proportion of records flagged. We can list flagged records using:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span><span class="op">[</span><span class="va">svy</span><span class="op">$</span><span class="va">flag</span> <span class="op">!=</span> <span class="fl">0</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;     school sex ageMonths weight height   haz   baz flag</span></span>
<span><span class="co">#&gt; 1     1112   1       173   25.5  179.0  1.70 -8.19    2</span></span>
<span><span class="co">#&gt; 2     1113   2       145   22.7  164.0  1.79 -6.81    2</span></span>
<span><span class="co">#&gt; 3     1116   1       150   13.5  135.0 -2.40 -8.64    2</span></span>
<span><span class="co">#&gt; 4     1123   1       150   25.3  165.0  1.73 -6.92    2</span></span>
<span><span class="co">#&gt; 5     1404   2       163   19.0  116.5 -6.05 -2.89    1</span></span>
<span><span class="co">#&gt; 23    1501   2       137   24.7  155.0  1.09 -5.20    2</span></span>
<span><span class="co">#&gt; 190   1507   1       173   24.0  154.0 -1.52 -6.46    2</span></span>
<span><span class="co">#&gt; 328   1511   1       138   26.9  165.5  2.82 -6.29    2</span></span>
<span><span class="co">#&gt; 969   1705   1       185   27.4  150.4 -2.62 -5.06    2</span></span>
<span><span class="co">#&gt; 970   1708   1       197   23.9  126.2 -6.19 -3.17    1</span></span>
<span><span class="co">#&gt; 971   1708   1       185   23.6  140.7 -3.86 -5.21    2</span></span>
<span><span class="co">#&gt; 972   1909   2       174   26.5  153.7 -1.04 -5.04    2</span></span>
<span><span class="co">#&gt; 973   2001   1       139   20.7  143.1 -0.49 -6.02    2</span></span></code></pre></div>
<p>The listed records can be checked and edited (see previous table).
Anthropometric indices can then be recalculated and the flagging process
repeated until all records that can be fixed have been fixed.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mark Myatt, Ernest Guevarra.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
